(()=>{function e(){let e=document.getElementById("index-container"),i=document.getElementById("rendered-article-feed");if(!e||!i)return;let{feedCategoryClick:n,feedCategoryImpression:s,feedContextType:o,feedConfigId:r}=e.dataset;window.mainFeedTracker||(window.mainFeedTracker=new t({feedItemsRoot:i,config:{categoryClick:n,categoryImpression:s,contextType:o,feedConfigId:r},contentIdAttribute:"feedContentId"})),window.mainFeedTracker.init()}var t=class{constructor({feedItemsRoot:e,config:t,contentIdAttribute:i="feedContentId"}){e&&t?(this.feedItemsRoot=e,this.config=t,this.contentIdAttribute=i,this.queue=[],this.processInterval=null,this.beaconEnabled=!0,this.nextFeedPosition=1,this.trackFeedImpressions=this.trackFeedImpressions.bind(this),this.trackFeedClickListener=this.trackFeedClickListener.bind(this),this.submitEventsBatch=this.submitEventsBatch.bind(this),this.observer=new IntersectionObserver(this.trackFeedImpressions,{root:null,rootMargin:"0px",threshold:.25})):console.error("FeedTracker: Missing required constructor options.")}init(){this.processInterval||(this.processInterval=setInterval(this.submitEventsBatch,5e3)),this.observer.disconnect(),this.nextFeedPosition=1,this.findAndTrackFeedItems(this.feedItemsRoot),this.ensureQueueIsClearedBeforeExit()}findAndTrackFeedItems(e){Array.from(e.children).forEach((e=>{var t;e.classList.contains("paged-stories")?this.findAndTrackFeedItems(e):null!=(t=e.dataset)&&t[this.contentIdAttribute]&&(e.dataset.feedContentId=e.dataset[this.contentIdAttribute],e.dataset.feedPosition=this.nextFeedPosition,e.addEventListener("mousedown",this.trackFeedClickListener,!0),this.observer.observe(e),this.nextFeedPosition+=1)}))}ensureQueueIsClearedBeforeExit(){this.exitListenersAttached||(document.addEventListener("visibilitychange",(()=>{"hidden"==document.visibilityState&&this.submitEventsBatch()})),window.addEventListener("beforeunload",this.submitEventsBatch),this.exitListenersAttached=!0)}trackFeedImpressions(e){e.forEach((e=>{e.isIntersecting&&e.intersectionRatio>=.25&&queueMicrotask((()=>{let t=e.target;t.dataset.impressionRecorded||(this.queueEvent(t,this.config.categoryImpression),t.dataset.impressionRecorded="true")}))}))}trackFeedClickListener(e){let t=e.currentTarget;t.dataset.clickRecorded||(this.queueEvent(t,this.config.categoryClick),t.dataset.clickRecorded="true",this.submitEventsBatch())}queueEvent(e,t){let{feedContentId:i,feedPosition:n}=e.dataset;this.queue.push({article_id:i,article_position:n,category:t,feed_config_id:this.config.feedConfigId,context_type:this.config.contextType}),this.queue.length>=20&&this.submitEventsBatch()}submitEventsBatch(){if(0===this.queue.length)return;let e=document.querySelector("meta[name='csrf-token']"),t=null==e?void 0:e.getAttribute("content"),i=[...this.queue];this.queue=[];let n={authenticity_token:t,feed_events:i};if(this.beaconEnabled&&navigator.sendBeacon){let e=new Blob([JSON.stringify(n)],{type:"application/json"});navigator.sendBeacon("/feed_events",e)||(this.beaconEnabled=!1,this.fallbackRequest(t,i))}else this.fallbackRequest(t,i)}fallbackRequest(e,t){window.fetch("/feed_events",{method:"POST",headers:{"X-CSRF-Token":e,"Content-Type":"application/json"},body:JSON.stringify({feed_events:t}),credentials:"same-origin",keepalive:!0}).catch((e=>console.error(e)))}};window.observeFeedElements=e;var i,n=(null==(i=document.getElementById("root-subforem-link"))?void 0:i.getAttribute("href").split("/")[2])||"";fetch(`/stories/feed/?page=1&type_of=discover&passed_domain=${n}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"same-origin"}).then((e=>e.json())).then((e=>{let i=document.getElementById("main-side-feed"),n=document.getElementById("article-show-container"),s=null;n&&(s=n.getAttribute("data-article-id")),i&&(i.innerHTML=e.map((e=>`\n      <a href="${e.url}" class="crayons-link crayons-link--contentful crayons-link--contentfulsidebar ${e.id===s?"active":""}" data-article-id="${e.id}">\n      ${e.main_image?`<img src="${e.main_image}" loading="lazy" alt="Cover Image" class="crayons-side-nav__item-cover" width="1000" height="${e.main_image_height}" style="aspect-ratio: 1000 / ${e.main_image_height}">`:""}\n      <div class="flex ${e.title.length<40?"items-center":""}">\n        <img src="${e.subforem_logo}" alt="Logo" class="crayons-side-nav__item-icon">\n        <span class="crayons-side-nav__item-text">${e.title}</span>\n      </div>\n      </a>\n    `)).join(""),void 0!==t&&new t({feedItemsRoot:i,contentIdAttribute:"articleId",config:{categoryClick:"click",categoryImpression:"impression",contextType:"sidebar",feedConfigId:e[0].feed_config}}).init());let o=document.querySelectorAll("#main-side-bar a");o.forEach((e=>{e.addEventListener("click",(()=>{o.forEach((e=>{e.classList.remove("hovered"),e.classList.add("not-hovered")}))}))}))})).catch((e=>{console.error("Error fetching stories:",e)})),window.InstantClick.on("change",(()=>{document.querySelectorAll(".crayons-side-nav__item.hovered").forEach((e=>{e.classList.remove("hovered"),e.classList.add("not-hovered")}));let e=document.getElementById("root-feed-card");e&&(e.scrollTop=0)}))})();